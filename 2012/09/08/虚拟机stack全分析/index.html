<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Language" contect="zh-CN">
  <meta name="DEscription" contect="潘俊俊 ITCamel itcamel 技术博客 java">
  <meta name="msvalidate.01" content="E9ABDA0017F73425E87A682DB620B6B6" />
  
  <title>虚拟机stack全分析 | ITCamel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta content="article" property="og:type">
<meta content="虚拟机stack全分析" property="og:title">
<meta content="www.itcamel.com/2012/09/08/虚拟机stack全分析/" property="og:url">
<meta property="og:image">
<meta content="ITCamel" property="og:site_name">
<meta content="通过jps -lv 获取到本地的一个JVM实例进程。再通过jstack pid  &gt; thread.txt ，把stack trace输出到thread.txt文件中。
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
4" property="og:description">
<meta content="summary" name="twitter:card">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <!--  -->
  
 
 <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
 
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ITCamel</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">关注IT浪潮，却在沙滩边拾捡贝壳的骆驼</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:www.itcamel.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-虚拟机stack全分析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/09/08/虚拟机stack全分析/" class="article-date">
  <time datetime="2012-09-08T13:48:01.000Z" itemprop="datePublished">9月 8 2012</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/系统运维/">系统运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      虚拟机stack全分析
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>通过jps -lv 获取到本地的一个JVM实例进程。再通过jstack pid  &gt; thread.txt ，把stack trace输出到thread.txt文件中。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
</pre></td><td class="code"><pre><span class="number">2012</span>-<span class="number">08</span>-<span class="number">28</span> <span class="number">23</span>:<span class="number">16</span>:<span class="number">39</span>  
Full thread dump OpenJDK Client VM (<span class="number">19.0</span>-b09 mixed mode, sharing):  
  
<span class="string">"Attach Listener"</span> daemon prio=<span class="number">10</span> tid=<span class="number">0xb3da5400</span> nid=<span class="number">0x13ea</span> waiting on condition [<span class="number">0x00000000</span>]  
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: RUNNABLE  
  
<span class="string">"Worker-15"</span> prio=<span class="number">10</span> tid=<span class="number">0x09b7b400</span> nid=<span class="number">0x12f2</span> <span class="keyword">in</span> Object<span class="preprocessor">.wait</span>() [<span class="number">0xb30f9000</span>]  
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: TIMED_WAITING (on object monitor)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span><span class="preprocessor">.wait</span>(Native Method)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.internal</span><span class="preprocessor">.jobs</span><span class="preprocessor">.WorkerPool</span><span class="preprocessor">.sleep</span>(WorkerPool<span class="preprocessor">.java</span>:<span class="number">188</span>)  
    - locked &lt;<span class="number">0x6e5f87c0</span>&gt; (a org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.internal</span><span class="preprocessor">.jobs</span><span class="preprocessor">.WorkerPool</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.internal</span><span class="preprocessor">.jobs</span><span class="preprocessor">.WorkerPool</span><span class="preprocessor">.startJob</span>(WorkerPool<span class="preprocessor">.java</span>:<span class="number">220</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.internal</span><span class="preprocessor">.jobs</span><span class="preprocessor">.Worker</span><span class="preprocessor">.run</span>(Worker<span class="preprocessor">.java</span>:<span class="number">50</span>)  
  
<span class="string">"Worker-12"</span> prio=<span class="number">10</span> tid=<span class="number">0x09910c00</span> nid=<span class="number">0x12a0</span> <span class="keyword">in</span> Object<span class="preprocessor">.wait</span>() [<span class="number">0xb4026000</span>]  
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: TIMED_WAITING (on object monitor)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span><span class="preprocessor">.wait</span>(Native Method)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.internal</span><span class="preprocessor">.jobs</span><span class="preprocessor">.WorkerPool</span><span class="preprocessor">.sleep</span>(WorkerPool<span class="preprocessor">.java</span>:<span class="number">188</span>)  
    - locked &lt;<span class="number">0x6e5f87c0</span>&gt; (a org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.internal</span><span class="preprocessor">.jobs</span><span class="preprocessor">.WorkerPool</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.internal</span><span class="preprocessor">.jobs</span><span class="preprocessor">.WorkerPool</span><span class="preprocessor">.startJob</span>(WorkerPool<span class="preprocessor">.java</span>:<span class="number">220</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.internal</span><span class="preprocessor">.jobs</span><span class="preprocessor">.Worker</span><span class="preprocessor">.run</span>(Worker<span class="preprocessor">.java</span>:<span class="number">50</span>)  
  
.......省略  
  
<span class="string">"Low Memory Detector"</span> daemon prio=<span class="number">10</span> tid=<span class="number">0x097eb000</span> nid=<span class="number">0xa9f</span> runnable [<span class="number">0x00000000</span>]  
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: RUNNABLE  
  
<span class="string">"CompilerThread0"</span> daemon prio=<span class="number">10</span> tid=<span class="number">0x097e9000</span> nid=<span class="number">0xa9e</span> waiting on condition [<span class="number">0x00000000</span>]  
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: RUNNABLE  
  
<span class="string">"Signal Dispatcher"</span> daemon prio=<span class="number">10</span> tid=<span class="number">0x097e7400</span> nid=<span class="number">0xa9d</span> runnable [<span class="number">0x00000000</span>]  
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: RUNNABLE  
  
<span class="string">"Finalizer"</span> daemon prio=<span class="number">10</span> tid=<span class="number">0x097e4000</span> nid=<span class="number">0xa9c</span> <span class="keyword">in</span> Object<span class="preprocessor">.wait</span>() [<span class="number">0xb4dd1000</span>]  
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: WAITING (on object monitor)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span><span class="preprocessor">.wait</span>(Native Method)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.ref</span><span class="preprocessor">.ReferenceQueue</span><span class="preprocessor">.remove</span>(ReferenceQueue<span class="preprocessor">.java</span>:<span class="number">133</span>)  
    - locked &lt;<span class="number">0x6e2e02f8</span>&gt; (a java<span class="preprocessor">.lang</span><span class="preprocessor">.ref</span><span class="preprocessor">.ReferenceQueue</span>$Lock)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.ref</span><span class="preprocessor">.ReferenceQueue</span><span class="preprocessor">.remove</span>(ReferenceQueue<span class="preprocessor">.java</span>:<span class="number">149</span>)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.ref</span><span class="preprocessor">.Finalizer</span>$FinalizerThread<span class="preprocessor">.run</span>(Finalizer<span class="preprocessor">.java</span>:<span class="number">177</span>)  
  
<span class="string">"Reference Handler"</span> daemon prio=<span class="number">10</span> tid=<span class="number">0x097df400</span> nid=<span class="number">0xa9b</span> <span class="keyword">in</span> Object<span class="preprocessor">.wait</span>() [<span class="number">0xb4e22000</span>]  
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: WAITING (on object monitor)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span><span class="preprocessor">.wait</span>(Native Method)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span><span class="preprocessor">.wait</span>(Object<span class="preprocessor">.java</span>:<span class="number">502</span>)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.ref</span><span class="preprocessor">.Reference</span>$ReferenceHandler<span class="preprocessor">.run</span>(Reference<span class="preprocessor">.java</span>:<span class="number">133</span>)  
    - locked &lt;<span class="number">0x6e2e0098</span>&gt; (a java<span class="preprocessor">.lang</span><span class="preprocessor">.ref</span><span class="preprocessor">.Reference</span>$Lock)  
  
<span class="string">"main"</span> prio=<span class="number">10</span> tid=<span class="number">0x097b0400</span> nid=<span class="number">0xa99</span> runnable [<span class="number">0xbf8b9000</span>]  
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: RUNNABLE  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.swt</span><span class="preprocessor">.internal</span><span class="preprocessor">.gtk</span><span class="preprocessor">.OS</span><span class="preprocessor">.Call</span>(Native Method)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.swt</span><span class="preprocessor">.widgets</span><span class="preprocessor">.Display</span><span class="preprocessor">.sleep</span>(Display<span class="preprocessor">.java</span>:<span class="number">4069</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.ui</span><span class="preprocessor">.application</span><span class="preprocessor">.WorkbenchAdvisor</span><span class="preprocessor">.eventLoopIdle</span>(WorkbenchAdvisor<span class="preprocessor">.java</span>:<span class="number">364</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.ui</span><span class="preprocessor">.internal</span><span class="preprocessor">.ide</span><span class="preprocessor">.application</span><span class="preprocessor">.IDEWorkbenchAdvisor</span><span class="preprocessor">.eventLoopIdle</span>(IDEWorkbenchAdvisor<span class="preprocessor">.java</span>:<span class="number">917</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.ui</span><span class="preprocessor">.internal</span><span class="preprocessor">.Workbench</span><span class="preprocessor">.runEventLoop</span>(Workbench<span class="preprocessor">.java</span>:<span class="number">2697</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.ui</span><span class="preprocessor">.internal</span><span class="preprocessor">.Workbench</span><span class="preprocessor">.runUI</span>(Workbench<span class="preprocessor">.java</span>:<span class="number">2660</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.ui</span><span class="preprocessor">.internal</span><span class="preprocessor">.Workbench</span><span class="preprocessor">.access</span>$4(Workbench<span class="preprocessor">.java</span>:<span class="number">2494</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.ui</span><span class="preprocessor">.internal</span><span class="preprocessor">.Workbench</span>$7<span class="preprocessor">.run</span>(Workbench<span class="preprocessor">.java</span>:<span class="number">674</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.databinding</span><span class="preprocessor">.observable</span><span class="preprocessor">.Realm</span><span class="preprocessor">.runWithDefault</span>(Realm<span class="preprocessor">.java</span>:<span class="number">332</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.ui</span><span class="preprocessor">.internal</span><span class="preprocessor">.Workbench</span><span class="preprocessor">.createAndRunWorkbench</span>(Workbench<span class="preprocessor">.java</span>:<span class="number">667</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.ui</span><span class="preprocessor">.PlatformUI</span><span class="preprocessor">.createAndRunWorkbench</span>(PlatformUI<span class="preprocessor">.java</span>:<span class="number">149</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.ui</span><span class="preprocessor">.internal</span><span class="preprocessor">.ide</span><span class="preprocessor">.application</span><span class="preprocessor">.IDEApplication</span><span class="preprocessor">.start</span>(IDEApplication<span class="preprocessor">.java</span>:<span class="number">123</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.equinox</span><span class="preprocessor">.internal</span><span class="preprocessor">.app</span><span class="preprocessor">.EclipseAppHandle</span><span class="preprocessor">.run</span>(EclipseAppHandle<span class="preprocessor">.java</span>:<span class="number">196</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.runtime</span><span class="preprocessor">.internal</span><span class="preprocessor">.adaptor</span><span class="preprocessor">.EclipseAppLauncher</span><span class="preprocessor">.runApplication</span>(EclipseAppLauncher<span class="preprocessor">.java</span>:<span class="number">110</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.runtime</span><span class="preprocessor">.internal</span><span class="preprocessor">.adaptor</span><span class="preprocessor">.EclipseAppLauncher</span><span class="preprocessor">.start</span>(EclipseAppLauncher<span class="preprocessor">.java</span>:<span class="number">79</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.runtime</span><span class="preprocessor">.adaptor</span><span class="preprocessor">.EclipseStarter</span><span class="preprocessor">.run</span>(EclipseStarter<span class="preprocessor">.java</span>:<span class="number">344</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.runtime</span><span class="preprocessor">.adaptor</span><span class="preprocessor">.EclipseStarter</span><span class="preprocessor">.run</span>(EclipseStarter<span class="preprocessor">.java</span>:<span class="number">179</span>)  
    at sun<span class="preprocessor">.reflect</span><span class="preprocessor">.NativeMethodAccessorImpl</span><span class="preprocessor">.invoke</span>0(Native Method)  
    at sun<span class="preprocessor">.reflect</span><span class="preprocessor">.NativeMethodAccessorImpl</span><span class="preprocessor">.invoke</span>(NativeMethodAccessorImpl<span class="preprocessor">.java</span>:<span class="number">57</span>)  
    at sun<span class="preprocessor">.reflect</span><span class="preprocessor">.DelegatingMethodAccessorImpl</span><span class="preprocessor">.invoke</span>(DelegatingMethodAccessorImpl<span class="preprocessor">.java</span>:<span class="number">43</span>)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.reflect</span><span class="preprocessor">.Method</span><span class="preprocessor">.invoke</span>(Method<span class="preprocessor">.java</span>:<span class="number">616</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.equinox</span><span class="preprocessor">.launcher</span><span class="preprocessor">.Main</span><span class="preprocessor">.invokeFramework</span>(Main<span class="preprocessor">.java</span>:<span class="number">622</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.equinox</span><span class="preprocessor">.launcher</span><span class="preprocessor">.Main</span><span class="preprocessor">.basicRun</span>(Main<span class="preprocessor">.java</span>:<span class="number">577</span>)  
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.equinox</span><span class="preprocessor">.launcher</span><span class="preprocessor">.Main</span><span class="preprocessor">.run</span>(Main<span class="preprocessor">.java</span>:<span class="number">1410</span>)  
  
<span class="string">"VM Thread"</span> prio=<span class="number">10</span> tid=<span class="number">0x097dd800</span> nid=<span class="number">0xa9a</span> runnable   
<span class="string">"GC task thread#0 (ParallelGC)"</span> prio=<span class="number">10</span> tid=<span class="number">0x08726800</span> nid=<span class="number">0x1e30</span> runnable  
  
<span class="string">"GC task thread#1 (ParallelGC)"</span> prio=<span class="number">10</span> tid=<span class="number">0x08727c00</span> nid=<span class="number">0x1e31</span> runnable  
  
<span class="string">"VM Periodic Task Thread"</span> prio=<span class="number">10</span> tid=<span class="number">0x097ed400</span> nid=<span class="number">0xaa0</span> waiting on condition   
  
JNI global references: <span class="number">2131</span>
</pre></td></tr></table></figure>

<p>上面的stack trace一共可以拆解成5个部分。</p>
<h4 id="第一部分:_Full_thread_dump_identifier">第一部分: Full thread dump identifier</h4>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="number">2012</span><span class="subst">-</span><span class="number">08</span><span class="subst">-</span><span class="number">28</span> <span class="number">23</span>:<span class="number">16</span>:<span class="number">39</span>  
<span class="literal">Full</span> <span class="keyword">thread</span> dump OpenJDK Client VM (<span class="number">19.0</span><span class="attribute">-b09</span> mixed mode, sharing):
</pre></td></tr></table></figure>

<p>可以看到dump时间，虚拟机的信息。</p>
<h4 id="第二部分:_Java_EE_middleware,_third_party_&amp;_custom_application_Threads">第二部分: Java EE middleware, third party &amp; custom application Threads</h4>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="string">"Worker-15"</span> prio=<span class="number">10</span> tid=<span class="number">0x09b7b400</span> nid=<span class="number">0x12f2</span> <span class="keyword">in</span> Object<span class="preprocessor">.wait</span>() [<span class="number">0xb30f9000</span>]    
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: TIMED_WAITING (on object monitor)    
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span><span class="preprocessor">.wait</span>(Native Method)    
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.internal</span><span class="preprocessor">.jobs</span><span class="preprocessor">.WorkerPool</span><span class="preprocessor">.sleep</span>(WorkerPool<span class="preprocessor">.java</span>:<span class="number">188</span>)    
    - locked &lt;<span class="number">0x6e5f87c0</span>&gt; (a org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.internal</span><span class="preprocessor">.jobs</span><span class="preprocessor">.WorkerPool</span>)    
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.internal</span><span class="preprocessor">.jobs</span><span class="preprocessor">.WorkerPool</span><span class="preprocessor">.startJob</span>(WorkerPool<span class="preprocessor">.java</span>:<span class="number">220</span>)    
    at org<span class="preprocessor">.eclipse</span><span class="preprocessor">.core</span><span class="preprocessor">.internal</span><span class="preprocessor">.jobs</span><span class="preprocessor">.Worker</span><span class="preprocessor">.run</span>(Worker<span class="preprocessor">.java</span>:<span class="number">50</span>)
</pre></td></tr></table></figure>


<p>此处是我们最为关心的地方，也是通过stack trace查找问题的地方,每个item的具体含义是<br>-Thread name: “Worker-15”<br>-线程优先级： prio=10<br>-java线程的identifier：tid=0x09b7b400<br>-native线程的identifier: nid=0x12f2<br>-线程的状态： in Object.wait()  java.lang.Thread.State: TIMED_WAITING (on object monitor)<br>-线程栈起始地址：[0xb30f9000]  </p>
<h5 id="Java线程和Native线程，也就是tid和nid的区别?">Java线程和Native线程，也就是tid和nid的区别?</h5>
<p>VM是加载并执行字节码的机器，这个处理不对应具体硬件，它完全由软件来实现。虚拟机并不是直接跑在宿主的cpu上，中间还隔着宿主的操作系统。</p>
<p>虚拟机的职责是：翻译字节码，把它翻译成一系列的动作（内存操作）和系统调用（比如输入输出）。举个例子：当在java里请求与某台远程机器建立socket连接时，java虚拟机本身是不能完成这一工作的（协议栈是在操作系统内实现的），所以它需要系统调用。要明白这个，还需要知道JRE和JVM的关系。JRE是JVM的环境，一个应用程序就是一个JVM实例。一个机器上一般同时只有一个JRE环境，但是可以同时有多个JVM实例。不同的操作系统和CPU架构有不同的JRE。JRE包含了最基本的类库，当然包括和操作系统打交道的Native库，比如windows下的dll文件，linux下的so文件。JVM实例解析字节码的成JVM中的指令集，再通过Native方法进行操作系统层面的系统调用。下面的图能比较清楚的说明问题。</p>
<h5 id="JVM线程如何创建">JVM线程如何创建</h5>
<p>当然是通过Native库的 native方法。JVM的线程最终是通过操作系统的线程来完成系统调用的。针对Java开发者来说，发号施令的是JVM 线程，具体干藏活累活的却是操作系统线程。不同操作系统上，JVM创建本地线程依赖的native库也不同。具体可参考下面的的文章。<a href="http://jackyhongvip.iteye.com/blog/1338610" target="_blank">http://jackyhongvip.iteye.com/blog/1338610</a></p>
<h5 id="JVM线程状态">JVM线程状态</h5>
<p>状态有Runnable、Wait on condition、Waiting for monitor entry 和 in Object.wait()。<br>Runnable：不解释<br>Wait on condition:该状态出现在线程等待某个条件的发生。具体是什么原因，可以结合 stacktrace来分析。最常见的情况是线程在等待网络的读写。如果网络数据没准备好，线程就等待在那里。另外一种出现 Wait on condition的常见情况是该线程在 sleep，等待 sleep的时间到了时候，将被唤醒。<br>Waiting for monitor entry 和 in Object.wait()：这两种情况在多线程的情况下经常出现。Java是通过Monitor来实现线程互斥和协作（有些把Monitor直译成锁，我认为不妥，不是还有Lock嘛）。具体Monitor的深入理解见 <a href="http://www.cnblogs.com/tomsheep/archive/2010/06/09/1754419.html" target="_blank">http://www.cnblogs.com/tomsheep/archive/2010/06/09/1754419.html</a><br>但是可以理解成Monitor是一个对象或者class所拥有的锁，每个对象和class有且仅有一个。见下图.</p>
<p>每个 Monitor在某个时刻，只能被一个线程拥有，该线程就是 “Active Thread”，而其它线程都是 “Waiting Thread”，分别在两个队列 “ Entry Set”和 “Wait Set”里面等候。<br>在 “ Entry Set”里面的线程都等待拿到Monitor，拿到了线程就成为了Runnable线程，否则就会一直处于处于 “waiting for monitor entry”。一段代码作为例子</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span>{</span>    
  
     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>() {    
         <span class="keyword">synchronized</span>(<span class="keyword">this</span>) {    
              <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1</span>; i--) {    
                   System.out.println(Thread.currentThread().getName() + <span class="string">" synchronized loop "</span> + i);    
              }    
         }    
    }    
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) {    
        MyThread t1 = <span class="keyword">new</span> MyThread();    
         Thread ta = <span class="keyword">new</span> Thread(t1, <span class="string">"A"</span>);    
         Thread tb = <span class="keyword">new</span> Thread(t1, <span class="string">"B"</span>);    
         ta.start();    
         tb.start();    
    }   
  
}
</pre></td></tr></table></figure>

<p>大家一看就知道，B线程肯定是“千年老二“，永远拿不到Monitor了。<br><code>对应的stack:</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="code"><pre><span class="string">"B"</span> prio=<span class="number">10</span> tid=<span class="number">0x0969a000</span> nid=<span class="number">0x11d6</span> waiting for monitor entry [<span class="number">0x8bb22000</span>]  
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: BLOCKED (on object monitor)  
    at org<span class="preprocessor">.marshal</span><span class="preprocessor">.MyThread</span><span class="preprocessor">.run</span>(MyThread<span class="preprocessor">.java</span>:<span class="number">7</span>)  
    - waiting to lock &lt;<span class="number">0x94757078</span>&gt; (a org<span class="preprocessor">.marshal</span><span class="preprocessor">.MyThread</span>)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.run</span>(Thread<span class="preprocessor">.java</span>:<span class="number">636</span>)  
  
<span class="string">"A"</span> prio=<span class="number">10</span> tid=<span class="number">0x09698800</span> nid=<span class="number">0x11d5</span> runnable [<span class="number">0x8bb73000</span>]  
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: RUNNABLE  
    at java<span class="preprocessor">.io</span><span class="preprocessor">.FileOutputStream</span><span class="preprocessor">.writeBytes</span>(Native Method)  
    at java<span class="preprocessor">.io</span><span class="preprocessor">.FileOutputStream</span><span class="preprocessor">.write</span>(FileOutputStream<span class="preprocessor">.java</span>:<span class="number">297</span>)  
    at java<span class="preprocessor">.io</span><span class="preprocessor">.BufferedOutputStream</span><span class="preprocessor">.flushBuffer</span>(BufferedOutputStream<span class="preprocessor">.java</span>:<span class="number">82</span>)  
    at java<span class="preprocessor">.io</span><span class="preprocessor">.BufferedOutputStream</span><span class="preprocessor">.flush</span>(BufferedOutputStream<span class="preprocessor">.java</span>:<span class="number">140</span>)  
    - locked &lt;<span class="number">0x947571b0</span>&gt; (a java<span class="preprocessor">.io</span><span class="preprocessor">.BufferedOutputStream</span>)  
    at java<span class="preprocessor">.io</span><span class="preprocessor">.PrintStream</span><span class="preprocessor">.write</span>(PrintStream<span class="preprocessor">.java</span>:<span class="number">449</span>)  
    - locked &lt;<span class="number">0x94757190</span>&gt; (a java<span class="preprocessor">.io</span><span class="preprocessor">.PrintStream</span>)  
    at sun<span class="preprocessor">.nio</span><span class="preprocessor">.cs</span><span class="preprocessor">.StreamEncoder</span><span class="preprocessor">.writeBytes</span>(StreamEncoder<span class="preprocessor">.java</span>:<span class="number">220</span>)  
    at sun<span class="preprocessor">.nio</span><span class="preprocessor">.cs</span><span class="preprocessor">.StreamEncoder</span><span class="preprocessor">.implFlushBuffer</span>(StreamEncoder<span class="preprocessor">.java</span>:<span class="number">290</span>)  
    at sun<span class="preprocessor">.nio</span><span class="preprocessor">.cs</span><span class="preprocessor">.StreamEncoder</span><span class="preprocessor">.flushBuffer</span>(StreamEncoder<span class="preprocessor">.java</span>:<span class="number">103</span>)  
    - locked &lt;<span class="number">0x947572a0</span>&gt; (a java<span class="preprocessor">.io</span><span class="preprocessor">.OutputStreamWriter</span>)  
    at java<span class="preprocessor">.io</span><span class="preprocessor">.OutputStreamWriter</span><span class="preprocessor">.flushBuffer</span>(OutputStreamWriter<span class="preprocessor">.java</span>:<span class="number">185</span>)  
    at java<span class="preprocessor">.io</span><span class="preprocessor">.PrintStream</span><span class="preprocessor">.write</span>(PrintStream<span class="preprocessor">.java</span>:<span class="number">494</span>)  
    - locked &lt;<span class="number">0x94757190</span>&gt; (a java<span class="preprocessor">.io</span><span class="preprocessor">.PrintStream</span>)  
    at java<span class="preprocessor">.io</span><span class="preprocessor">.PrintStream</span><span class="preprocessor">.print</span>(PrintStream<span class="preprocessor">.java</span>:<span class="number">636</span>)  
    at java<span class="preprocessor">.io</span><span class="preprocessor">.PrintStream</span><span class="preprocessor">.println</span>(PrintStream<span class="preprocessor">.java</span>:<span class="number">773</span>)  
    - locked &lt;<span class="number">0x94757190</span>&gt; (a java<span class="preprocessor">.io</span><span class="preprocessor">.PrintStream</span>)  
    at org<span class="preprocessor">.marshal</span><span class="preprocessor">.MyThread</span><span class="preprocessor">.run</span>(MyThread<span class="preprocessor">.java</span>:<span class="number">8</span>)  
    - locked &lt;<span class="number">0x94757078</span>&gt; (a org<span class="preprocessor">.marshal</span><span class="preprocessor">.MyThread</span>)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.run</span>(Thread<span class="preprocessor">.java</span>:<span class="number">636</span>)  
   &lt;<span class="number">0x94757078</span>&gt; 就是两个线程争夺的Monitor。
</pre></td></tr></table></figure>

<p>在 “Wait Set”里面的线程都如饥似渴地等待拿到Monitor。他们是怎么进入到“Wait Set”的呢？当一个线程拿到了Monitor，但是在其他资源没有到位的情况下，调用同步锁对象（一般是synchronized()内的对象）的 wait() 方法，放弃了 Monitor，它就进入到了 “Wait Set”队列。只有当其他线程通过notify() 或者 notifyAll()，释放了同步锁后，这个线程才会有机会重新去竞争Monitor。在stack中，它表现的状态是in Object.wait()。<br><code>修改上面的代码</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WaitThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span>{</span> 
<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>() {    
      <span class="keyword">synchronized</span>(<span class="keyword">this</span>) {   
        <span class="keyword">try</span> {  
        <span class="keyword">this</span>.wait();  
    } <span class="keyword">catch</span> (InterruptedException e) {  
        <span class="comment">// TODO Auto-generated catch block  </span>
        e.printStackTrace();  
    }              
      }    
 }    
 <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) {    
   WaitThread t1 = <span class="keyword">new</span> WaitThread();    
      Thread ta = <span class="keyword">new</span> Thread(t1, <span class="string">"A"</span>);    
      Thread tb = <span class="keyword">new</span> Thread(t1, <span class="string">"B"</span>);    
      ta.start();    
      tb.start();            
 }
</pre></td></tr></table></figure>

<p><code>对应的stack</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="code"><pre><span class="string">"B"</span> prio=<span class="number">10</span> tid=<span class="number">0x08173000</span> nid=<span class="number">0x1304</span> <span class="keyword">in</span> Object<span class="preprocessor">.wait</span>() [<span class="number">0x8baf2000</span>]  
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: WAITING (on object monitor)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span><span class="preprocessor">.wait</span>(Native Method)  
    - waiting on &lt;<span class="number">0xa9cb50e0</span>&gt; (a org<span class="preprocessor">.marshal</span><span class="preprocessor">.WaitThread</span>)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span><span class="preprocessor">.wait</span>(Object<span class="preprocessor">.java</span>:<span class="number">502</span>)  
    at org<span class="preprocessor">.marshal</span><span class="preprocessor">.WaitThread</span><span class="preprocessor">.run</span>(WaitThread<span class="preprocessor">.java</span>:<span class="number">8</span>)  
    - locked &lt;<span class="number">0xa9cb50e0</span>&gt; (a org<span class="preprocessor">.marshal</span><span class="preprocessor">.WaitThread</span>)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.run</span>(Thread<span class="preprocessor">.java</span>:<span class="number">636</span>)  
  
<span class="string">"A"</span> prio=<span class="number">10</span> tid=<span class="number">0x08171c00</span> nid=<span class="number">0x1303</span> <span class="keyword">in</span> Object<span class="preprocessor">.wait</span>() [<span class="number">0x8bb43000</span>]  
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: WAITING (on object monitor)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span><span class="preprocessor">.wait</span>(Native Method)  
    - waiting on &lt;<span class="number">0xa9cb50e0</span>&gt; (a org<span class="preprocessor">.marshal</span><span class="preprocessor">.WaitThread</span>)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span><span class="preprocessor">.wait</span>(Object<span class="preprocessor">.java</span>:<span class="number">502</span>)  
    at org<span class="preprocessor">.marshal</span><span class="preprocessor">.WaitThread</span><span class="preprocessor">.run</span>(WaitThread<span class="preprocessor">.java</span>:<span class="number">8</span>)  
    - locked &lt;<span class="number">0xa9cb50e0</span>&gt; (a org<span class="preprocessor">.marshal</span><span class="preprocessor">.WaitThread</span>)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.run</span>(Thread<span class="preprocessor">.java</span>:<span class="number">636</span>)
</pre></td></tr></table></figure>

<p>A和B线程都进入了”wait set“。B线程也拿到过这个Monitor，因为A线程释放过了，这也验证上面的话，他们都在等待得而复失的<0xa9cb50e0>。</p>
<p>基于我们经常讨论到的死锁问题，构造一段代码如下</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeadThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span>{</span>  
      
    <span class="keyword">private</span> Object monitor_A = <span class="keyword">new</span> Object();  
      
    <span class="keyword">private</span> Object monitor_B = <span class="keyword">new</span> Object();  
      
    <span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">method_A</span>(){  
         <span class="keyword">synchronized</span>(monitor_A) {   
               <span class="keyword">synchronized</span>(monitor_B) {   
                   System.out.println(Thread.currentThread().getName()+<span class="string">" invoke method A"</span>);  
               }                  
           }          
    }  
      
    <span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">method_B</span>(){  
         <span class="keyword">synchronized</span>(monitor_B) {   
               <span class="keyword">synchronized</span>(monitor_A) {   
                   System.out.println(Thread.currentThread().getName()+<span class="string">" invoke method B"</span>);  
               }                  
           }          
    }     
  
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>() {       
        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1</span>;i--){               
            method_A();            
            method_B();                        
        }              
    }  
       
  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) {    
      DeadThread t1 = <span class="keyword">new</span> DeadThread();    
       Thread ta = <span class="keyword">new</span> Thread(t1, <span class="string">"A"</span>);    
       Thread tb = <span class="keyword">new</span> Thread(t1, <span class="string">"B"</span>);    
    
       ta.start();    
       tb.start();   
  }   
}
</pre></td></tr></table></figure>

<p>对应的stack:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="string">"B"</span> prio=<span class="number">10</span> tid=<span class="number">0x0898d000</span> nid=<span class="number">0x269a</span> waiting for monitor entry [<span class="number">0x8baa2000</span>]  
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: BLOCKED (on object monitor)  
    at org<span class="preprocessor">.marshal</span><span class="preprocessor">.DeadThread</span><span class="preprocessor">.method</span>_A(DeadThread<span class="preprocessor">.java</span>:<span class="number">11</span>)  
    - waiting to lock &lt;<span class="number">0xaa4d6f88</span>&gt; (a java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span>)  
    - locked &lt;<span class="number">0xaa4d6f80</span>&gt; (a java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span>)  
    at org<span class="preprocessor">.marshal</span><span class="preprocessor">.DeadThread</span><span class="preprocessor">.run</span>(DeadThread<span class="preprocessor">.java</span>:<span class="number">28</span>)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.run</span>(Thread<span class="preprocessor">.java</span>:<span class="number">636</span>)  
  
<span class="string">"A"</span> prio=<span class="number">10</span> tid=<span class="number">0x0898b800</span> nid=<span class="number">0x2699</span> waiting for monitor entry [<span class="number">0x8baf3000</span>]  
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: BLOCKED (on object monitor)  
    at org<span class="preprocessor">.marshal</span><span class="preprocessor">.DeadThread</span><span class="preprocessor">.method</span>_B(DeadThread<span class="preprocessor">.java</span>:<span class="number">19</span>)  
    - waiting to lock &lt;<span class="number">0xaa4d6f80</span>&gt; (a java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span>)  
    - locked &lt;<span class="number">0xaa4d6f88</span>&gt; (a java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span>)  
    at org<span class="preprocessor">.marshal</span><span class="preprocessor">.DeadThread</span><span class="preprocessor">.run</span>(DeadThread<span class="preprocessor">.java</span>:<span class="number">29</span>)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.run</span>(Thread<span class="preprocessor">.java</span>:<span class="number">636</span>)  
 同时注意到，在stack trace尾部信息
</pre></td></tr></table></figure>


<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="code"><pre>Found one Java-level deadlock:  
=============================  
<span class="string">"B"</span>:  
  waiting to lock monitor <span class="number">0x089615d8</span> (object <span class="number">0xaa4d6f88</span>, a java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span>),  
  which is held by <span class="string">"A"</span>  
<span class="string">"A"</span>:  
  waiting to lock monitor <span class="number">0x08962258</span> (object <span class="number">0xaa4d6f80</span>, a java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span>),  
  which is held by <span class="string">"B"</span>  
  
Java stack information for the threads listed above:  
===================================================  
<span class="string">"B"</span>:  
    at org<span class="preprocessor">.marshal</span><span class="preprocessor">.DeadThread</span><span class="preprocessor">.method</span>_A(DeadThread<span class="preprocessor">.java</span>:<span class="number">11</span>)  
    - waiting to lock &lt;<span class="number">0xaa4d6f88</span>&gt; (a java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span>)  
    - locked &lt;<span class="number">0xaa4d6f80</span>&gt; (a java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span>)  
    at org<span class="preprocessor">.marshal</span><span class="preprocessor">.DeadThread</span><span class="preprocessor">.run</span>(DeadThread<span class="preprocessor">.java</span>:<span class="number">28</span>)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.run</span>(Thread<span class="preprocessor">.java</span>:<span class="number">636</span>)  
<span class="string">"A"</span>:  
    at org<span class="preprocessor">.marshal</span><span class="preprocessor">.DeadThread</span><span class="preprocessor">.method</span>_B(DeadThread<span class="preprocessor">.java</span>:<span class="number">19</span>)  
    - waiting to lock &lt;<span class="number">0xaa4d6f80</span>&gt; (a java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span>)  
    - locked &lt;<span class="number">0xaa4d6f88</span>&gt; (a java<span class="preprocessor">.lang</span><span class="preprocessor">.Object</span>)  
    at org<span class="preprocessor">.marshal</span><span class="preprocessor">.DeadThread</span><span class="preprocessor">.run</span>(DeadThread<span class="preprocessor">.java</span>:<span class="number">29</span>)  
    at java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.run</span>(Thread<span class="preprocessor">.java</span>:<span class="number">636</span>)  
  
Found <span class="number">1</span> deadlock.
</pre></td></tr></table></figure>

<p>stack中直接报告了Java级别的死锁，够智能吧。</p>
<h4 id="第三部分：HotSpot_VM_Thread">第三部分：HotSpot VM Thread</h4>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="string">"Low Memory Detector"</span> daemon prio=<span class="number">10</span> tid=<span class="number">0x097eb000</span> nid=<span class="number">0xa9f</span> runnable [<span class="number">0x00000000</span>]    
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: RUNNABLE    
    
<span class="string">"CompilerThread0"</span> daemon prio=<span class="number">10</span> tid=<span class="number">0x097e9000</span> nid=<span class="number">0xa9e</span> waiting on condition [<span class="number">0x00000000</span>]    
   java<span class="preprocessor">.lang</span><span class="preprocessor">.Thread</span><span class="preprocessor">.State</span>: RUNNABLE
</pre></td></tr></table></figure>


<p>JVM管理的内部线程，这些内部线程都是来执行native操作的，可以不必太关注。</p>
<h4 id="第四部分：_HotSpot_GC_Thread">第四部分： HotSpot GC Thread</h4>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="string">"GC task thread#0 (ParallelGC)"</span> prio=<span class="number">10</span> tid=<span class="number">0</span>x08726800 nid=<span class="number">0</span>x1e30 runnable  
  
<span class="string">"GC task thread#1 (ParallelGC)"</span> prio=<span class="number">10</span> tid=<span class="number">0</span>x08727c00 nid=<span class="number">0</span>x1e31 runnable
</pre></td></tr></table></figure>

<p>当虚拟机打开了parallel GC，这些线程就会定期地GC清理。</p>
<h4 id="第五部分：JNI_global_references_count">第五部分：JNI global references count</h4>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>JNI <span class="keyword">global</span> references: <span class="number">2131</span>
</pre></td></tr></table></figure>

<p>JNI (Java Native Interface)全局引用也是受垃圾回收器管理。它的作用是防止回收到那些在native代码上还是被引用的，但是在java代码中却没有存活必要的引用。对于防止因为应用代码中直接使用native库或者第三方的一些监控工具的内存泄漏有非常大的帮助。</p>
<h4 id="参考文献：">参考文献：</h4>
<p><a href="http://peiliping.ixiezi.com/2012/04/15/jvm-jstack%E7%94%A8%E6%B3%95/" target="_blank">http://peiliping.ixiezi.com/2012/04/15/jvm-jstack%E7%94%A8%E6%B3%95/</a><br><a href="http://www.cnblogs.com/tomsheep/archive/2010/06/09/1754419.html" target="_blank">http://www.cnblogs.com/tomsheep/archive/2010/06/09/1754419.html</a><br><a href="http://www.javacodegeeks.com/2012/03/jvm-how-to-analyze-thread-dump.html" target="_blank">http://www.javacodegeeks.com/2012/03/jvm-how-to-analyze-thread-dump.html</a><br><a href="http://blog.csdn.net/fenglibing/article/details/6411940" target="_blank">http://blog.csdn.net/fenglibing/article/details/6411940</a></p>

      
    </div>
    <footer class="article-footer">
 

      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JVM/">JVM</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/性能优化/">性能优化</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/虚拟机/">虚拟机</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2012/11/16/instrument小窥/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Instrument小窥
        
      </div>
    </a>
  
  
    <a href="/2012/08/27/jvm-commondline/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">JVM实用commandline</div>
    </a>
  
</nav>

  
</article>




         <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_xg" data-cmd="xg" title="分享到鲜果"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{},"image":{"viewList":["tsina","douban","tqq","weixin","xg"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","douban","tqq","weixin","xg"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>



    <!-- 多说评论框 start -->
 <h1 class="title">comment</h1>
 <div class="ds-thread" data-title="虚拟机stack全分析"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"huoyanxueren"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->



</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java基础/">Java基础</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux系统知识/">Linux系统知识</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/交流分享/">交流分享</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/开源框架/">开源框架</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构/">架构</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/系统运维/">系统运维</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chuwa/">Chuwa</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DMA/">DMA</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flume/">Flume</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MMU/">MMU</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SVN/">SVN</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SVNKit/">SVNKit</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scribe/">Scribe</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zero-copy/">Zero-copy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dependency/">dependency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/infoq/">infoq</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jps/">jps</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jstat/">jstat</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nio/">nio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/qcon/">qcon</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/">spring</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/会议/">会议</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/北京/">北京</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/性能优化/">性能优化</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/性能，优化，服务器，负载/">性能，优化，服务器，负载</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/日志/">日志</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/杂谈/">杂谈</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/虚拟机/">虚拟机</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Chuwa/" style="font-size: 10.00px;">Chuwa</a><a href="/tags/DMA/" style="font-size: 10.00px;">DMA</a><a href="/tags/Flume/" style="font-size: 10.00px;">Flume</a><a href="/tags/JVM/" style="font-size: 20.00px;">JVM</a><a href="/tags/MMU/" style="font-size: 10.00px;">MMU</a><a href="/tags/SVN/" style="font-size: 10.00px;">SVN</a><a href="/tags/SVNKit/" style="font-size: 10.00px;">SVNKit</a><a href="/tags/Scribe/" style="font-size: 10.00px;">Scribe</a><a href="/tags/Zero-copy/" style="font-size: 10.00px;">Zero-copy</a><a href="/tags/dependency/" style="font-size: 10.00px;">dependency</a><a href="/tags/infoq/" style="font-size: 10.00px;">infoq</a><a href="/tags/jps/" style="font-size: 10.00px;">jps</a><a href="/tags/jstat/" style="font-size: 10.00px;">jstat</a><a href="/tags/kafka/" style="font-size: 10.00px;">kafka</a><a href="/tags/linux/" style="font-size: 10.00px;">linux</a><a href="/tags/maven/" style="font-size: 10.00px;">maven</a><a href="/tags/nio/" style="font-size: 10.00px;">nio</a><a href="/tags/qcon/" style="font-size: 10.00px;">qcon</a><a href="/tags/spring/" style="font-size: 10.00px;">spring</a><a href="/tags/会议/" style="font-size: 10.00px;">会议</a><a href="/tags/北京/" style="font-size: 10.00px;">北京</a><a href="/tags/性能优化/" style="font-size: 15.00px;">性能优化</a><a href="/tags/性能，优化，服务器，负载/" style="font-size: 10.00px;">性能，优化，服务器，负载</a><a href="/tags/日志/" style="font-size: 10.00px;">日志</a><a href="/tags/杂谈/" style="font-size: 10.00px;">杂谈</a><a href="/tags/虚拟机/" style="font-size: 15.00px;">虚拟机</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06">六月 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04">四月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02">二月 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11">十一月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09">九月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08">八月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03">三月 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10">十月 2011</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2014/06/24/spring-custom-tag/">Spring自定义标签</a>
          </li>
        
          <li>
            <a href="/2014/06/23/dependency-conflict/">jar依赖冲突解决实践</a>
          </li>
        
          <li>
            <a href="/2014/04/25/qcon-1st/">北京Qcon走马观花</a>
          </li>
        
          <li>
            <a href="/2013/02/26/nio-grammer/">NIO学习全概括</a>
          </li>
        
          <li>
            <a href="/2013/02/19/zero-copy/">zero-copy</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
<h3 class="widget-title">友情链接</h3>
<ul class="entry widget">
<li><a href="http://gkbusy.iteye.com/" title="gkbusy's Blog">gkbusy的博客</a></li>
<li><a href="http://javatar.iteye.com/" title="梁飞的博客">梁飞的博客</a></li>
<li><a href="http://agapple.iteye.com/" title="agapple's Blog">agapple的博客</a></li>
<li><a href="http://www.alidata.org/" title="阿里数据平台">阿里数据平台</a></li>
<li><a href="http://www.yangbolin.github.io/myblog/" title="yangbolin">yangbolin的blog</a></li>
</ul>
</div>

  
    <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=1946907151&verifier=c39dc63c&dpc=1"></iframe>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 潘俊俊<br>
      阿里巴巴资深开发工程师、Java、大数据、语言<br>
      E-mail:1983@live.cn<br>
      Powered by <a href="http://itcamel.com" target="_blank">潘俊俊</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    <script src="/fancybox/jquery-1.7.2.min.js"></script>


<!-- <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css"> -->
<!-- <script src="/fancybox/jquery.fancybox.pack.js"></script> -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Ff3d905ba4b2eaa8c625d50b00801cb47' type='text/javascript'%3E%3C/script%3E"));
</script>



<script type="text/javascript" src="/js/script.js"></script>

  </div>
</body>
</html>
